# pwg_cookieconsent
[![Donate](https://img.shields.io/badge/Donate-PayPal-green.svg)](https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=C7HN4VAGBTQFS&currency_code=EUR)

<a href="https://www.buymeacoffee.com/kipjr" target="_blank"><img src="https://user-images.githubusercontent.com/12066560/94989781-8bd26280-0577-11eb-9482-26faff60e95d.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;" ></a>

Simple cookie consent for Piwigo



Due to the recent GDPR / Cookie law , websites must show a banner when it uses cookies. This plugin might resolve some issues related to a missing banner/notification
Please be aware that, for as far as I can see, it is not possible to disable cookies without impacting the functional aspects of Piwigo.

On the admin configuration page you can set the size (fullscreen or banner), a custom message and a link to a specific page related to your cookie policy.


Piwigo uses two types of cookies. One additional persistent cookie (1y) can be set as opose of a session cookie.


| Name        | Purpose           | Data  | Server data |
| ------------- |:-------------:| -----:| -----:|
| pwg_id    | session cookie  | random 32 alfanumeric id |  pwg_device\|s:7:"desktop";<br> pwg_mobile_theme\|b:0;<br> pwg_uid\|i:1;<br><b>pwg_cconsent\|b:1;</b> | 
| pwg_remember     | auto login cookie      |   ~57 some value |
| pwg_cc_persistent_cookie | store cookie choice on visitor device | boolean | none

The bold value in 'Server data' is due to this plugin. 

![image](https://user-images.githubusercontent.com/12066560/97817090-6336a900-1c9a-11eb-98b6-e0d43053e97f.png)

___
# Screenshots
## Admin Configuration

Pre 2.10f

![image](https://user-images.githubusercontent.com/12066560/94938903-bb2e9400-04d1-11eb-889f-af164317d2e2.png)

2.10f

![image](https://user-images.githubusercontent.com/12066560/97817021-09ce7a00-1c9a-11eb-9621-8e82f946c675.png)


## Live
![image](https://user-images.githubusercontent.com/12066560/94938785-99cda800-04d1-11eb-8da7-0e9595a8a81c.png)


# Structure

<a href="https://mermaid.live/edit#eyJjb2RlIjoiZmxvd2NoYXJ0IFREXG5tYWluW1ttYWluLmluYy5waHBdXVxubWFpbnRhaW5bW21haW50YWluLmluYy5waHBdXVxuYWRtaW5bYWRtaW4ucGhwXVxuY29va2llY29uc2VudF9wYWdlLnRwbChbdGVtcGxhdGUvY29va2llY29uc2VudF9wYWdlLnRwbF0pXG5jb25maWcucGhwW2FkbWluL2NvbmZpZy5waHBdXG5jb25maWcudHBsKFthZG1pbi90ZW1wbGF0ZS9jb25maWcudHBsXSlcbmFkbWluX2V2ZW50c1tpbmNsdWRlL2FkbWluX2V2ZW50cy5pbmMucGhwXVxuY29va2llY29uc2VudFtpbmNsdWRlL2Nvb2tpZWNvbnNlbnQuYXBpLnBocF1cbmNvb2tpZWNvbnNlbnRfcGFnZS5pbmMucGhwW2luY2x1ZGUvY29va2llY29uc2VudF9wYWdlLmluYy5waHBdXG5wdWJsaWNfZXZlbnRzW2luY2x1ZGUvcHVibGljX2V2ZW50cy5pbmMucGhwXVxuc2NyaXB0PnRlbXBsYXRlL3NjcmlwdC5qc11cbnBfaW5kZXhbW2luZGV4LnBocF1dXG5jbGllbnRfY29va2lle3tDbGllbnQgQ29va2llfX1cbmNsaWVudF9jb29raWUye3tDbGllbnQgQ29va2llfX1cbnNlc3Npb25fY29va2lle3tTZXNzaW9uIENvb2tpZX19XG5zZXNzaW9uX2Nvb2tpZTJ7e1Nlc3Npb24gQ29va2llfX1cbmRhdGFiYXNlWyhQaXdpZ29fREIpXVxuaW5zdGFsbFtcXGluc3RhbGwvXVxuYWN0aXZhdGVbXFxhY3RpdmF0ZS9dXG5kZWFjdGl2YXRlW1xcZGVhY3RpdmF0ZS9dXG51cGRhdGVbXFx1cGRhdGUvXVxudW5pbnN0YWxsW1xcdW5pbnN0YWxsL11cblxuc3ViZ3JhcGggTWFpbnRlbmFuY2Vcbm1haW50YWluIC0tPiBpbnN0YWxsXG5tYWludGFpbiAtLT4gYWN0aXZhdGVcbm1haW50YWluIC0tPiBkZWFjdGl2YXRlXG5tYWludGFpbiAtLT4gdXBkYXRlLS0-aW5zdGFsbFxubWFpbnRhaW4gLS0-IHVuaW5zdGFsbFxuZW5kXG51bmluc3RhbGwgLS5jb25mX2RlbGV0ZV9wYXJhbTpjb29raWVjb25zZW50LS4tPmRhdGFiYXNlXG5pbnN0YWxsLS5jb25mX3VwZGF0ZV9wYXJhbTpjb29raWVjb25zZW50Li0-IGRhdGFiYXNlXG5cbnN1YmdyYXBoIEFkbWluaXN0cmF0aW9uXG5hZG1pbi0uY29va2llY29uc2VudF9hZG1pbl9wbHVnaW5fbWVudV9saW5rcy4tYWRtaW5fZXZlbnRzXG5tYWluIC0uY29va2llY29uc2VudF9pbml0Li4tPmFkbWluLS0-Y29uZmlnLnBocFxuY29uZmlnLnBocC0tU21hcnR5LS0-Y29uZmlnLnRwbC0tSFRUUF9QT1NULS0-Y29uZmlnLnBocFxuZW5kXG5jb25maWcucGhwLS5jb25mX3VwZGF0ZV9wYXJhbTpjb29raWVjb25zZW50Li0-IGRhdGFiYXNlXG5kYXRhYmFzZSA8LS0-IHNlc3Npb25fY29va2llXG5zZXNzaW9uX2Nvb2tpZSAtLi0-IHBfaW5kZXhcbmNsaWVudF9jb29raWUgLS4tPiBwX2luZGV4XG5cbm1haW4gLS5jb29raWVjb25zZW50X2luaXQuLT5wX2luZGV4LS0-cHVibGljX2V2ZW50c1xucHVibGljX2V2ZW50cy0tY29va2llY29uc2VudF9sb2NfZW5kX3BhZ2UtLT5jb29raWVjb25zZW50X3BhZ2UuaW5jLnBocFxuY29va2llY29uc2VudF9wYWdlLmluYy5waHAtLVNtYXJ0eS0tPmNvb2tpZWNvbnNlbnRfcGFnZS50cGwgLS1sb2FkSlNmaWxlLS0-IHNjcmlwdFxuc2NyaXB0IC0uSFRUUF9QT1NULi0-IGNvb2tpZWNvbnNlbnRcbmNvb2tpZWNvbnNlbnQgLS4tPiBjbGllbnRfY29va2llMlxuY29va2llY29uc2VudCAtLi0-IHNlc3Npb25fY29va2llMiIsIm1lcm1haWQiOiJ7XG4gIFwidGhlbWVcIjogXCJkZWZhdWx0XCJcbn0iLCJ1cGRhdGVFZGl0b3IiOmZhbHNlLCJhdXRvU3luYyI6dHJ1ZSwidXBkYXRlRGlhZ3JhbSI6ZmFsc2V9"> <img src="https://mermaid.ink/img/eyJjb2RlIjoiZmxvd2NoYXJ0IFREXG5tYWluW1ttYWluLmluYy5waHBdXVxubWFpbnRhaW5bW21haW50YWluLmluYy5waHBdXVxuYWRtaW5bYWRtaW4ucGhwXVxuY29va2llY29uc2VudF9wYWdlLnRwbChbdGVtcGxhdGUvY29va2llY29uc2VudF9wYWdlLnRwbF0pXG5jb25maWcucGhwW2FkbWluL2NvbmZpZy5waHBdXG5jb25maWcudHBsKFthZG1pbi90ZW1wbGF0ZS9jb25maWcudHBsXSlcbmFkbWluX2V2ZW50c1tpbmNsdWRlL2FkbWluX2V2ZW50cy5pbmMucGhwXVxuY29va2llY29uc2VudFtpbmNsdWRlL2Nvb2tpZWNvbnNlbnQuYXBpLnBocF1cbmNvb2tpZWNvbnNlbnRfcGFnZS5pbmMucGhwW2luY2x1ZGUvY29va2llY29uc2VudF9wYWdlLmluYy5waHBdXG5wdWJsaWNfZXZlbnRzW2luY2x1ZGUvcHVibGljX2V2ZW50cy5pbmMucGhwXVxuc2NyaXB0PnRlbXBsYXRlL3NjcmlwdC5qc11cbnBfaW5kZXhbW2luZGV4LnBocF1dXG5jbGllbnRfY29va2lle3tDbGllbnQgQ29va2llfX1cbmNsaWVudF9jb29raWUye3tDbGllbnQgQ29va2llfX1cbnNlc3Npb25fY29va2lle3tTZXNzaW9uIENvb2tpZX19XG5zZXNzaW9uX2Nvb2tpZTJ7e1Nlc3Npb24gQ29va2llfX1cbmRhdGFiYXNlWyhQaXdpZ29fREIpXVxuaW5zdGFsbFtcXGluc3RhbGwvXVxuYWN0aXZhdGVbXFxhY3RpdmF0ZS9dXG5kZWFjdGl2YXRlW1xcZGVhY3RpdmF0ZS9dXG51cGRhdGVbXFx1cGRhdGUvXVxudW5pbnN0YWxsW1xcdW5pbnN0YWxsL11cblxuc3ViZ3JhcGggTWFpbnRlbmFuY2Vcbm1haW50YWluIC0tPiBpbnN0YWxsXG5tYWludGFpbiAtLT4gYWN0aXZhdGVcbm1haW50YWluIC0tPiBkZWFjdGl2YXRlXG5tYWludGFpbiAtLT4gdXBkYXRlLS0-aW5zdGFsbFxubWFpbnRhaW4gLS0-IHVuaW5zdGFsbFxuZW5kXG51bmluc3RhbGwgLS5jb25mX2RlbGV0ZV9wYXJhbTpjb29raWVjb25zZW50LS4tPmRhdGFiYXNlXG5pbnN0YWxsLS5jb25mX3VwZGF0ZV9wYXJhbTpjb29raWVjb25zZW50Li0-IGRhdGFiYXNlXG5cbnN1YmdyYXBoIEFkbWluaXN0cmF0aW9uXG5hZG1pbi0uY29va2llY29uc2VudF9hZG1pbl9wbHVnaW5fbWVudV9saW5rcy4tYWRtaW5fZXZlbnRzXG5tYWluIC0uY29va2llY29uc2VudF9pbml0Li4tPmFkbWluLS0-Y29uZmlnLnBocFxuY29uZmlnLnBocC0tU21hcnR5LS0-Y29uZmlnLnRwbC0tSFRUUF9QT1NULS0-Y29uZmlnLnBocFxuZW5kXG5jb25maWcucGhwLS5jb25mX3VwZGF0ZV9wYXJhbTpjb29raWVjb25zZW50Li0-IGRhdGFiYXNlXG5kYXRhYmFzZSA8LS0-IHNlc3Npb25fY29va2llXG5zZXNzaW9uX2Nvb2tpZSAtLi0-IHBfaW5kZXhcbmNsaWVudF9jb29raWUgLS4tPiBwX2luZGV4XG5cbm1haW4gLS5jb29raWVjb25zZW50X2luaXQuLT5wX2luZGV4LS0-cHVibGljX2V2ZW50c1xucHVibGljX2V2ZW50cy0tY29va2llY29uc2VudF9sb2NfZW5kX3BhZ2UtLT5jb29raWVjb25zZW50X3BhZ2UuaW5jLnBocFxuY29va2llY29uc2VudF9wYWdlLmluYy5waHAtLVNtYXJ0eS0tPmNvb2tpZWNvbnNlbnRfcGFnZS50cGwgLS1sb2FkSlNmaWxlLS0-IHNjcmlwdFxuc2NyaXB0IC0uSFRUUF9QT1NULi0-IGNvb2tpZWNvbnNlbnRcbmNvb2tpZWNvbnNlbnQgLS4tPiBjbGllbnRfY29va2llMlxuY29va2llY29uc2VudCAtLi0-IHNlc3Npb25fY29va2llMiIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2UsImF1dG9TeW5jIjp0cnVlLCJ1cGRhdGVEaWFncmFtIjpmYWxzZX0)](https://mermaid.live/edit#eyJjb2RlIjoiZmxvd2NoYXJ0IFREXG5tYWluW1ttYWluLmluYy5waHBdXVxubWFpbnRhaW5bW21haW50YWluLmluYy5waHBdXVxuYWRtaW5bYWRtaW4ucGhwXVxuY29va2llY29uc2VudF9wYWdlLnRwbChbdGVtcGxhdGUvY29va2llY29uc2VudF9wYWdlLnRwbF0pXG5jb25maWcucGhwW2FkbWluL2NvbmZpZy5waHBdXG5jb25maWcudHBsKFthZG1pbi90ZW1wbGF0ZS9jb25maWcudHBsXSlcbmFkbWluX2V2ZW50c1tpbmNsdWRlL2FkbWluX2V2ZW50cy5pbmMucGhwXVxuY29va2llY29uc2VudFtpbmNsdWRlL2Nvb2tpZWNvbnNlbnQuYXBpLnBocF1cbmNvb2tpZWNvbnNlbnRfcGFnZS5pbmMucGhwW2luY2x1ZGUvY29va2llY29uc2VudF9wYWdlLmluYy5waHBdXG5wdWJsaWNfZXZlbnRzW2luY2x1ZGUvcHVibGljX2V2ZW50cy5pbmMucGhwXVxuc2NyaXB0PnRlbXBsYXRlL3NjcmlwdC5qc11cbnBfaW5kZXhbW2luZGV4LnBocF1dXG5jbGllbnRfY29va2lle3tDbGllbnQgQ29va2llfX1cbmNsaWVudF9jb29raWUye3tDbGllbnQgQ29va2llfX1cbnNlc3Npb25fY29va2lle3tTZXNzaW9uIENvb2tpZX19XG5zZXNzaW9uX2Nvb2tpZTJ7e1Nlc3Npb24gQ29va2llfX1cbmRhdGFiYXNlWyhQaXdpZ29fREIpXVxuaW5zdGFsbFtcXGluc3RhbGwvXVxuYWN0aXZhdGVbXFxhY3RpdmF0ZS9dXG5kZWFjdGl2YXRlW1xcZGVhY3RpdmF0ZS9dXG51cGRhdGVbXFx1cGRhdGUvXVxudW5pbnN0YWxsW1xcdW5pbnN0YWxsL11cblxuc3ViZ3JhcGggTWFpbnRlbmFuY2Vcbm1haW50YWluIC0tPiBpbnN0YWxsXG5tYWludGFpbiAtLT4gYWN0aXZhdGVcbm1haW50YWluIC0tPiBkZWFjdGl2YXRlXG5tYWludGFpbiAtLT4gdXBkYXRlLS0-aW5zdGFsbFxubWFpbnRhaW4gLS0-IHVuaW5zdGFsbFxuZW5kXG51bmluc3RhbGwgLS5jb25mX2RlbGV0ZV9wYXJhbTpjb29raWVjb25zZW50LS4tPmRhdGFiYXNlXG5pbnN0YWxsLS5jb25mX3VwZGF0ZV9wYXJhbTpjb29raWVjb25zZW50Li0-IGRhdGFiYXNlXG5cbnN1YmdyYXBoIEFkbWluaXN0cmF0aW9uXG5hZG1pbi0uY29va2llY29uc2VudF9hZG1pbl9wbHVnaW5fbWVudV9saW5rcy4tYWRtaW5fZXZlbnRzXG5tYWluIC0uY29va2llY29uc2VudF9pbml0Li4tPmFkbWluLS0-Y29uZmlnLnBocFxuY29uZmlnLnBocC0tU21hcnR5LS0-Y29uZmlnLnRwbC0tSFRUUF9QT1NULS0-Y29uZmlnLnBocFxuZW5kXG5jb25maWcucGhwLS5jb25mX3VwZGF0ZV9wYXJhbTpjb29raWVjb25zZW50Li0-IGRhdGFiYXNlXG5kYXRhYmFzZSA8LS0-IHNlc3Npb25fY29va2llXG5zZXNzaW9uX2Nvb2tpZSAtLi0-IHBfaW5kZXhcbmNsaWVudF9jb29raWUgLS4tPiBwX2luZGV4XG5cbm1haW4gLS5jb29raWVjb25zZW50X2luaXQuLT5wX2luZGV4LS0-cHVibGljX2V2ZW50c1xucHVibGljX2V2ZW50cy0tY29va2llY29uc2VudF9sb2NfZW5kX3BhZ2UtLT5jb29raWVjb25zZW50X3BhZ2UuaW5jLnBocFxuY29va2llY29uc2VudF9wYWdlLmluYy5waHAtLVNtYXJ0eS0tPmNvb2tpZWNvbnNlbnRfcGFnZS50cGwgLS1sb2FkSlNmaWxlLS0-IHNjcmlwdFxuc2NyaXB0IC0uSFRUUF9QT1NULi0-IGNvb2tpZWNvbnNlbnRcbmNvb2tpZWNvbnNlbnQgLS4tPiBjbGllbnRfY29va2llMlxuY29va2llY29uc2VudCAtLi0-IHNlc3Npb25fY29va2llMiIsIm1lcm1haWQiOiJ7XG4gIFwidGhlbWVcIjogXCJkZWZhdWx0XCJcbn0iLCJ1cGRhdGVFZGl0b3IiOmZhbHNlLCJhdXRvU3luYyI6dHJ1ZSwidXBkYXRlRGlhZ3JhbSI6ZmFsc2V9" alt=" 
<!--
flowchart TD
main[[main.inc.php]]
maintain[[maintain.inc.php]]
admin[admin.php]
cookieconsent_page.tpl([template/cookieconsent_page.tpl])
config.php[admin/config.php]
config.tpl([admin/template/config.tpl])
admin_events[include/admin_events.inc.php]
cookieconsent[include/cookieconsent.api.php]
cookieconsent_page.inc.php[include/cookieconsent_page.inc.php]
public_events[include/public_events.inc.php]
script>template/script.js]
p_index[[index.php]]
client_cookie{{Client Cookie}}
client_cookie2{{Client Cookie}}
session_cookie{{Session Cookie}}
session_cookie2{{Session Cookie}}
database[(Piwigo_DB)]
install[\install/]
activate[\activate/]
deactivate[\deactivate/]
update[\update/]
uninstall[\uninstall/]

subgraph Maintenance
maintain --> install
maintain --> activate
maintain --> deactivate
maintain --> update-->install
maintain --> uninstall
end
uninstall -.conf_delete_param:cookieconsent-.->database
install-.conf_update_param:cookieconsent.-> database

subgraph Administration
admin-.cookieconsent_admin_plugin_menu_links.-admin_events
main -.cookieconsent_init..->admin-->config.php
config.php--Smarty-->config.tpl--HTTP_POST-->config.php
end
config.php-.conf_update_param:cookieconsent.-> database
database <--> session_cookie
session_cookie -.-> p_index
client_cookie -.-> p_index

main -.cookieconsent_init.->p_index-->public_events
public_events--cookieconsent_loc_end_page-->cookieconsent_page.inc.php
cookieconsent_page.inc.php--Smarty-->cookieconsent_page.tpl --loadJSfile--> script
script -.HTTP_POST.-> cookieconsent
cookieconsent -.-> client_cookie2
cookieconsent -.-> session_cookie2

-->
" width="" height="700">
</a>
